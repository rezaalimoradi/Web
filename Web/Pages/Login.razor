@page "/login"
@using global::Shared.Dtos.User
@inject IHasibApi Api
@inject TokenProvider TokenProvider
@inject NavigationManager Nav

<h3>Login</h3>

<input @bind="username" placeholder="Username" />
<input @bind="password" type="password" placeholder="Password" />
<button @onclick="LoginAsync">Login</button>

<p>@message</p>

@code {
    private string username = "admin";
    private string password = "123";
    private string message = "";

    private async Task LoginAsync()
    {
        var result = await Api.LoginAsync(new LoginRequest
        {
            Username = username,
            Password = password
        });

        if (result.IsSuccessStatusCode && result.Content != null)
        {
            var token = result.Content.Token;
            await TokenProvider.SetTokenAsync(token);

            message = "✅ Login successful!";
            Nav.NavigateTo("/");
        }
        else
        {
            message = "❌ Login failed!";
        }
    }
}
